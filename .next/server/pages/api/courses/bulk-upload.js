"use strict";(()=>{var e={};e.id=8809,e.ids=[8809],e.modules={4280:e=>{e.exports=require("csv-parser")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2048:e=>{e.exports=require("fs")},6705:e=>{e.exports=import("formidable")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},4910:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>d,default:()=>u,routeModule:()=>p});var s=r(1802),i=r(7153),o=r(6249),n=r(8935),l=e([n]);n=(l.then?(await l)():l)[0];let u=(0,o.l)(n,"default"),d=(0,o.l)(n,"config"),p=new s.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/courses/bulk-upload",pathname:"/api/courses/bulk-upload",bundlePath:"",filename:""},userland:n});a()}catch(e){a(e)}})},8935:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>p,default:()=>d});var s=r(6705),i=r(2048),o=r.n(i),n=r(4280),l=r.n(n),u=e([s]);s=(u.then?(await u)():u)[0];let p={api:{bodyParser:!1}};async function d(e,t){if("POST"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let r=(0,s.default)({uploadDir:"./uploads",keepExtensions:!0,maxFileSize:10485760}),[a,i]=await r.parse(e),n=i.file?.[0];if(!n)return t.status(400).json({message:"No file uploaded"});if(!n.originalFilename?.endsWith(".csv"))return t.status(400).json({message:"File must be a CSV"});let u=[],d=[],p=0,c=["title","code","description","start_date","end_date","max_students"],f=new Promise((e,t)=>{o().createReadStream(n.filepath).pipe(l()()).on("data",e=>{p++;let t=c.filter(t=>!e[t]||""===e[t].trim());if(t.length>0){d.push(`Row ${p}: Missing required columns: ${t.join(", ")}`);return}let r=new Date(e.start_date),a=new Date(e.end_date);if(isNaN(r.getTime())){d.push(`Row ${p}: Invalid start_date format`);return}if(isNaN(a.getTime())){d.push(`Row ${p}: Invalid end_date format`);return}if(r>=a){d.push(`Row ${p}: start_date must be before end_date`);return}let s=parseInt(e.max_students);if(isNaN(s)||s<1){d.push(`Row ${p}: max_students must be a positive number`);return}let i={title:e.title.trim(),code:e.code.trim(),description:e.description.trim(),startDate:r.toISOString(),endDate:a.toISOString(),maxStudents:s,objectives:e.objectives?.trim()||"",prerequisites:e.prerequisites?.trim()||"",allowSelfEnrollment:"true"===e.allow_self_enrollment,sendNotifications:"false"!==e.send_notifications};u.push(i)}).on("end",()=>{e()}).on("error",e=>{t(e)})});if(await f,o().unlinkSync(n.filepath),0===u.length&&0===d.length)return t.status(400).json({message:"CSV file appears to be empty"});let m=0,h=0,g=[];for(let t=0;t<u.length;t++){let r=u[t];try{let t=await fetch("http://localhost:5000/api/courses",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.headers.authorization?.replace("Bearer ","")}`},body:JSON.stringify(r)});if(t.ok)(await t.json()).created?m++:h++;else{let e=await t.json();g.push(`Course "${r.title}": ${e.message||"Failed to create"}`)}}catch(e){console.error("Error processing course:",e),g.push(`Course "${r.title}": Network error`)}}let P=[...d,...g];t.status(200).json({message:"Upload completed",total:u.length,created:m,updated:h,errors:P,success:!0})}catch(e){console.error("CSV upload error:",e),t.status(500).json({message:"Failed to process CSV file",error:e.message})}}a()}catch(e){a(e)}})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=4910);module.exports=r})();